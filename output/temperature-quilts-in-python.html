
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />

  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="/theme/stylesheet/style.min.css">


    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
          href="/theme/pygments/github.min.css">



  <link rel="stylesheet" type="text/css" href="/theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="/theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="/theme/font-awesome/css/solid.css">


  <link rel="shortcut icon" href="/images/Dye.png" type="image/x-icon">
  <link rel="icon" href="/images/Dye.png" type="image/x-icon">


  <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Python, data science, and art Atom">



 

<meta name="author" content="Heather Ann Dye" />
<meta name="description" content="What is a temperature quilt? A temperature quilt displays the daily temperature data from a specific date range in a specific location. Colors are assigned to specific temperature ranges so that the quilt (or image) is a visual record of the climate. This app is a demonstration project for data …" />
<meta name="keywords" content="pandas, pillow, streamlit">


  <meta property="og:site_name" content="Python, data science, and art"/>
  <meta property="og:title" content="Temperature Quilts in Python"/>
  <meta property="og:description" content="What is a temperature quilt? A temperature quilt displays the daily temperature data from a specific date range in a specific location. Colors are assigned to specific temperature ranges so that the quilt (or image) is a visual record of the climate. This app is a demonstration project for data …"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="/temperature-quilts-in-python.html"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2023-01-31 00:00:00-06:00"/>
  <meta property="article:modified_time" content=""/>
  <meta property="article:author" content="/author/heather-ann-dye.html">
  <meta property="article:section" content="data science, art"/>
  <meta property="article:tag" content="pandas"/>
  <meta property="article:tag" content="pillow"/>
  <meta property="article:tag" content="streamlit"/>
  <meta property="og:image" content="/images/ProfilePic.jpg">

  <title>Python, data science, and art &ndash; Temperature Quilts in Python</title>


</head>
<body class="light-theme">

<aside>
  <div>
    <a href="/">
      <img src="/images/ProfilePic.jpg" alt="Heather Ann Dye" title="Heather Ann Dye">
    </a>

    <h1>
      <a href="/">Heather Ann Dye</a>
    </h1>

    <p>Data Enthusiast</p>


    <nav>
      <ul class="list">


            <li>
              <a target="_self"
                 href="/pages/about.html#about">
                About
              </a>
            </li>

          <li>
            <a target="_self" href="https://zbmath.org/authors/?q=Heather+Ann+Dye" >My Publications</a>
          </li>
          <li>
            <a target="_self" href="https://www.heatheranndye.com/" >Textile Art</a>
          </li>
      </ul>
    </nav>

    <ul class="social">
      <li>
        <a class="sc-linkedin"
           href="https://www.linkedin.com/in/heather-ann-dye-44712720/"
           target="_blank">
          <i class="fa-brands fa-linkedin"></i>
        </a>
      </li>
      <li>
        <a class="sc-github"
           href="https://github.com/heatheranndye"
           target="_blank">
          <i class="fa-brands fa-github"></i>
        </a>
      </li>
    </ul>
  </div>

</aside>
  <main>

<nav>
  <a href="/">Home</a>

  <a href="/archives.html">Archives</a>
  <a href="/categories.html">Categories</a>
  <a href="/tags.html">Tags</a>

  <a href="/feeds/all.atom.xml">Atom</a>

</nav>

<article class="single">
  <header>
      
    <h1 id="temperature-quilts-in-python">Temperature Quilts in Python</h1>
    <p>
      Posted on Tue 31 January 2023 in <a href="/category/data-science-art.html">data science, art</a>

    </p>
  </header>


  <div>
    <h2>What is a temperature quilt?</h2>
<p>A temperature quilt displays the daily temperature data from a specific date range in a specific location. Colors are assigned to specific temperature ranges so that
the quilt (or image) is a visual record of the climate.  This app is a demonstration project for data storytelling that I constructed in the <a href="https://pybit.es/">PyBites Professional Developer Mindset Program</a>. </p>
<p>This project uses pandas, Pillow, matplotlib along with Streamlit.io to construct a data story and a work of art! 
This project has some unique constraints and requirements (including a pdf quilt pattern) so users can construct an actual quilt using a commercially available fabric.</p>
<h4>A photo of my <em>constructed</em> data quilt</h4>
<p><img alt="jpg" src="/images/data_quilt_files/actualdataquilt.jpg"></p>
<h4>Digital Quilt Mockup and Streamlit</h4>
<p>The streamlit app is located at <a href="https://h-a-dye-dataquilt-streamstreamlit-app-zwncqy.streamlit.app/">DataQuilt</a>. Once you've opened the app, simply put in your US zip code and year.  Then, the app will automatically search for the closest weather station that contains a maximum amount of data for your specified year.
The information comes from the <a href="https://www.noaa.gov/">National Oceanic and Atmospheric Administration</a>'s (NOAA) Global Historical Climatology Network daily (GHCNd) of weather stations. Once the closest weather station with the most data is located (not all weather stations have a complete data set), the daily maximum temperature data is binned and each bin is associated with a particular color. From this, a digital mock-up of a temperature quilt and a corresponding pattern for the physical construction of the quilt is created automatically. </p>
<p>The code is located in the github repository: <a href="https://github.com/H-A-Dye/DataQuilt">H-A-DYE/DataQuilt</a>. </p>
<p>If you're interested in the art post about this project, it is located at <a href="https://heatheranndye.com">Heather Ann Dye Art</a>.</p>
<h3>Where to get the data</h3>
<p>In the dataquilt package, the weather_station_inv module sorts through NOAA's inventory of weather stations. 
NOAA provides an inventory of weather stations at <a href="&quot;https://www1.ncdc.noaa.gov/pub/data/ghcn/daily/ghcnd-inventory.txt">https://www1.ncdc.noaa.gov/pub/data/ghcn/daily/ghcnd-inventory.txt</a>. Each line in this text file lists a weather station, along with its lattitude and longitude and years of activity. 
This module strips the information out of the text file using string methods and creates a pandas dataframe. Next, weather stations are eliminated from the dataframe based on years of availability.  Then, the provided zip code is converted into latitude and longitude (using geopy) and the distance between each weather station and the zip code is in nautical miles.  The app uses the 10 closest weather stations in the next step.</p>
<h3>Request data from NOAA for a specific weather station</h3>
<p>In data_from_api, data for a selected year and weather station is requested from NOAA. However,
not all weather stations have a complete set of records. The app examines the 10 closest weather stations and selects the weather station that has the most complete set of data. I used the requests package to request the data from NOAA and extract a json data which is transformed into a pandas data frame. The data frame is examined for missing values and out of the 10 nearest weather stations, the closest station with the least missing data is selected. In the next step, the app creates a digital mockup of the quilt. </p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">identify_missing_data</span><span class="p">(</span>
    <span class="n">data_series</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Returns the indices of nan values in a pandas Data Series.</span>
<span class="sd">    Args:</span>
<span class="sd">        data_series (pd.Series): pd.Series</span>
<span class="sd">    Returns:</span>
<span class="sd">        list: List of indices with nan values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">local_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">data_series</span><span class="o">.</span><span class="n">isnull</span><span class="p">())</span>
    <span class="n">local_list</span> <span class="o">=</span> <span class="n">local_array</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">local_list</span>
</code></pre></div>

<h3>Descriptive Statistics with pandas</h3>
<p>In image_generator,
pandas is used to organize the data into a suitable format. Using pandas'  descriptive statistics methods, I constructed a custom binning function based on the maximum and minimum <em>maximum</em> daily temperatures from the dataset. This custom binning function sorts the data into <em>bins</em> ennumerated from 0 to 14. Lambda functions are used to reformat the date and the binned maximum daily temperatures.  Next, the  dataframe is reshaped and missing data values are filled with a <em>null</em> value of 15. Each numerical value from 0 to 15 corresponds to a specific color in the digital mockup. This binned dataframe is use to create the digital mockup. </p>
<div class="highlight"><pre><span></span><code> <span class="n">my_dates</span> <span class="o">=</span> <span class="n">noaa_data</span><span class="o">.</span><span class="n">DATE</span>
    <span class="n">datetimes</span> <span class="o">=</span> <span class="n">my_dates</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span>
            <span class="n">x</span><span class="p">,</span>
            <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">months</span> <span class="o">=</span> <span class="n">datetimes</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>
    <span class="n">days</span> <span class="o">=</span> <span class="n">datetimes</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
    <span class="n">noaa_data</span> <span class="o">=</span> <span class="n">noaa_data</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">days</span><span class="p">)</span>
    <span class="n">noaa_data</span> <span class="o">=</span> <span class="n">noaa_data</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="n">months</span><span class="p">)</span>
    <span class="n">my_levels</span> <span class="o">=</span> <span class="n">noaa_data</span><span class="o">.</span><span class="n">TMAX</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">grade_temp</span><span class="p">(</span>
            <span class="n">noaa_data</span><span class="p">,</span>
            <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">noaa_data</span> <span class="o">=</span> <span class="n">noaa_data</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">levels</span><span class="o">=</span><span class="n">my_levels</span><span class="p">)</span>
    <span class="n">my_small</span> <span class="o">=</span> <span class="n">noaa_data</span><span class="p">[[</span><span class="s2">&quot;months&quot;</span><span class="p">,</span> <span class="s2">&quot;days&quot;</span><span class="p">,</span> <span class="s2">&quot;levels&quot;</span><span class="p">]]</span>
    <span class="n">my_reshape</span> <span class="o">=</span> <span class="n">my_small</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span>
        <span class="n">index</span><span class="o">=</span><span class="s2">&quot;days&quot;</span><span class="p">,</span>
        <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;months&quot;</span><span class="p">,</span>
        <span class="n">values</span><span class="o">=</span><span class="s2">&quot;levels&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">my_reshape</span> <span class="o">=</span> <span class="n">my_reshape</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">15.0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">my_reshape</span>
</code></pre></div>

<p>The next step is to tabulate the number of days in each bin and record the temperature ranges and insert these values into a data frame. 
This data frame is essentially a frequency distribution table and is formated with the end user in mind. 
Streamlit.io displays both the binned dataframe and the tabulated dataframe, which are also available in the pdf pattern file. 
The binned dataframe and the Pillow package are used to create the digital  mockup of the quilt. </p>
<p><img alt="jpg" src="/images/data_quilt_files/samplequilt.jpg"></p>
<h3>Real fabric!</h3>
<p>In the colors_kona module,
we construct rgb codes for real, commercially available fabric colors in the Kona cotton fabric line, a commercially available fabric line. This brings my pdf pattern into line with industry standards for quilt patterns. Quilters can purchase the listed fabrics and create a quilt identical to the digital mockup. </p>
<p>Here is the color range for your reference. </p>
<p><img alt="png" src="/images/data_quilt_files/ColorRange.PNG"></p>
<p>The cmyk color codes to rgb codes and created a dictionary to contain the color information. </p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">make_kona_dictionary</span><span class="p">(</span><span class="n">colorlist</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">COLORENNUMERATE</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Takes a dictionary of Kona color names and number keys and returns a</span>
<span class="sd">    dictionary with number key and Color_Information for Pillow.</span>
<span class="sd">    Args:</span>
<span class="sd">        colorlist (dict, optional): Kona color list and keys.</span>
<span class="sd">        Defaults to COLORENNUMERATE.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">color_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">colorlist</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="n">color_name</span> <span class="o">=</span> <span class="n">colorlist</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">local_row</span> <span class="o">=</span> <span class="n">DF_KONA</span><span class="p">[</span><span class="n">DF_KONA</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">color_name</span><span class="p">)]</span>
        <span class="n">cmyk</span> <span class="o">=</span> <span class="n">local_row</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">rgb</span> <span class="o">=</span> <span class="n">color_conversion_rgb</span><span class="p">(</span><span class="n">cmyk</span><span class="p">)</span>
        <span class="n">kona_info</span> <span class="o">=</span> <span class="n">ColorInformation</span><span class="p">(</span><span class="n">color_name</span><span class="p">,</span> <span class="n">rgb</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">color_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">i</span><span class="p">:</span> <span class="n">kona_info</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">color_dict</span>
</code></pre></div>

<h3>Streamlit Dashboard</h3>
<p>The frontend/dashboard is constructed using Streamlit.io. Streamlit displays each step of the process outlined above. The data can be inspected in the dashboard and the download button allows users to download a pdf with all the necessary information to create a physical version of the digital mockup. The app can be used to create multiple mockups based on year and zip code.  </p>
<h2>Conclusion</h2>
<p>This fun demonstration project has led to several other on-going projects that I hope to blog about soon. So if you're interested in data storytelling in a community friendly way, keep following along!</p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="/tag/pandas.html">pandas</a>
      <a href="/tag/pillow.html">pillow</a>
      <a href="/tag/streamlit.html">streamlit</a>
    </p>
  </div>






</article>

<footer>
<p>&copy;  </p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
</p></footer>  </main>

<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Python, data science, and art ",
  "url" : "",
  "image": "/images/ProfilePic.jpg",
  "description": "Data Science"
}
</script>
</body>
</html>